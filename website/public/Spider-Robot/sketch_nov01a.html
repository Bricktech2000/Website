<pre>
<font color="#434f54">&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;</font>
<font color="#434f54">&#47;&#47; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVO LIBRARY &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;</font>
<font color="#434f54">&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;</font>


<font color="#434f54">&#47;&#47;Servo library: only up to 12 servos</font>
<font color="#434f54">&#47;&#47;SoftwareServo library: as many servos as we want, but massive current spikes when updated</font>

<font color="#434f54">&#47;&#47;so...</font>

<font color="#434f54">&#47;&#47;This is a servo library that can handle up to 20 servos using one 16-bit and one 8-bit hardware timers.</font>
<font color="#434f54">&#47;&#47;The pulse width for a servo has a maximum error of 8 microseconds, which is not noticeable.</font>
<font color="#434f54">&#47;&#47;It has 15-bit precision and updates each servo at 40Hz, which is not ideal</font>
<font color="#434f54">&#47;&#47;(max is 50Hz), but I needed to sacrifice the update frequency for some more servos</font>
<font color="#434f54">&#47;&#47;If you want to handle more than 20 servos at once, the update frequency will automatically decrease.</font>
<font color="#434f54">&#47;&#47;You can modify this code to use more than one 16-bit timers, but I haven&#39;t because most arduino boards only have one.</font>



<font color="#434f54">&#47;&#47;for some reason... that works... (</font><u><font color="#434f54">https:&#47;&#47;waterproofman.wordpress.com&#47;2007&#47;02&#47;07&#47;avr-interrupts-in-c&#47;</font></u><font color="#434f54">)</font>
<font color="#434f54">&#47;&#47;gotta do dis to be able to make interrupt functions friends of the Servo class</font>
<font color="#00979c">extern</font> <font color="#005c5f">&#34;C&#34;</font> <font color="#00979c">void</font> <font color="#000000">TIMER2_COMPB_vect</font><font color="#000000">(</font><font color="#00979c">void</font><font color="#000000">)</font> <font color="#000000">__attribute__</font> <font color="#000000">(</font><font color="#000000">(</font><font color="#d35400">signal</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
<font color="#00979c">extern</font> <font color="#005c5f">&#34;C&#34;</font> <font color="#00979c">void</font> <font color="#000000">TIMER1_COMPB_vect</font><font color="#000000">(</font><font color="#00979c">void</font><font color="#000000">)</font> <font color="#000000">__attribute__</font> <font color="#000000">(</font><font color="#000000">(</font><font color="#d35400">signal</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
<font color="#00979c">extern</font> <font color="#005c5f">&#34;C&#34;</font> <font color="#00979c">void</font> <font color="#000000">TIMER1_COMPA_vect</font><font color="#000000">(</font><font color="#00979c">void</font><font color="#000000">)</font> <font color="#000000">__attribute__</font> <font color="#000000">(</font><font color="#000000">(</font><font color="#d35400">signal</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>

<font color="#00979c">class</font> <b><font color="#d35400">Servo</font></b> <font color="#000000">{</font>
<font color="#00979c">public</font><font color="#434f54">:</font>
 &nbsp;<font color="#00979c">static</font> <font color="#00979c">bool</font> <font color="#000000">enabled</font><font color="#000000">;</font>
 &nbsp;<b><font color="#d35400">Servo</font></b><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">{</font><font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;attach a servo to a pin...</font>
 &nbsp;<font color="#00979c">uint8_t</font> <font color="#d35400">attach</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">_pin</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;initialize the hardware timers if not already</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#434f54">!</font><font color="#000000">timersInitialized</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">initializeTimers</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">timersInitialized</font> <font color="#434f54">=</font> <font color="#00979c">true</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set the pin of the servo as an output</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">pin</font> <font color="#434f54">=</font> <font color="#000000">_pin</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">pinMode</font><font color="#000000">(</font><font color="#000000">pin</font><font color="#434f54">,</font> <font color="#00979c">OUTPUT</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;increase the servoCount</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">servoCount</font><font color="#434f54">++</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#95a5a6">&#47;*&#47;&#47;allocate a new array with one more servo in it</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;Servo** newServos = (Servo**)new Servo*[servoCount];</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&#47;&#47;copy every servo pointer from the old array to the new</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&#47;&#47;and reset the old array to 0 (or not)</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;for(int s = 0; s &lt; servoCount - 1; s++){</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newServos[s] = servos[s];</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;servos[s] = 0;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;}</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&#47;&#47;set the last servo in the new array to be this servo</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;newServos[servoCount - 1] = this;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&#47;&#47;if there are more than 0 servos, delete the old array</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&#47;&#47;if(servos != nullptr) delete[] servos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&#47;&#47;set Servo::servos to the newly allocated array</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;servos = newServos;*&#47;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">servoCount</font> <font color="#434f54">-</font> <font color="#000000">1</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#5e6d03">this</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;write the pulse width of the servo in microseconds</font>
 &nbsp;<font color="#00979c">void</font> <font color="#d35400">writeMicroseconds</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">value</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;make sure the requested microseconds value is in range</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">value</font> <font color="#434f54">&lt;</font> <font color="#000000">600</font><font color="#000000">)</font> <font color="#000000">value</font> <font color="#434f54">=</font> <font color="#000000">600</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">value</font> <font color="#434f54">&gt;</font> <font color="#000000">2400</font><font color="#000000">)</font> <font color="#000000">value</font> <font color="#434f54">=</font> <font color="#000000">2400</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;write the value to this servo&#39;s pulseWidth variable</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">pulseWidth</font> <font color="#434f54">=</font> <font color="#000000">value</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;write the pulse width of the servo in degrees</font>
 &nbsp;<font color="#00979c">void</font> <font color="#d35400">write</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">value</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;map the value (0-180) from 600 to 2400 microseconds</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">int</font> <font color="#000000">microseconds</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">value</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">180</font><font color="#434f54">,</font> <font color="#000000">500</font> <font color="#434f54">+</font> <font color="#000000">100</font><font color="#434f54">,</font> <font color="#000000">2500</font> <font color="#434f54">-</font> <font color="#000000">100</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;send it to the writeMicroseconds function</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">writeMicroseconds</font><font color="#000000">(</font><font color="#000000">microseconds</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;takes a value in us and a prescaler as an argument.</font>
 &nbsp;<font color="#434f54">&#47;&#47;returns the value at which the specified microseconds will have elapsed</font>
 &nbsp;<font color="#434f54">&#47;&#47;since the last reset of the timer to 0</font>
 &nbsp;<font color="#00979c">static</font> <font color="#00979c">int</font> <font color="#000000">usToTimer</font><font color="#000000">(</font><font color="#00979c">float</font> <font color="#000000">value</font><font color="#434f54">,</font> <font color="#00979c">int</font> <font color="#000000">prescaler</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font> <font color="#000000">(</font><font color="#000000">value</font> <font color="#434f54">&#47;</font> <font color="#000000">1000000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">(</font><font color="#000000">16000000</font> <font color="#434f54">&#47;</font> <font color="#000000">prescaler</font><font color="#000000">)</font> <font color="#434f54">-</font> <font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#00979c">friend</font> <font color="#00979c">void</font> <font color="#000000">TIMER2_COMPB_vect</font><font color="#000000">(</font><font color="#00979c">void</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">friend</font> <font color="#00979c">void</font> <font color="#000000">TIMER1_COMPB_vect</font><font color="#000000">(</font><font color="#00979c">void</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">friend</font> <font color="#00979c">void</font> <font color="#000000">TIMER1_COMPA_vect</font><font color="#000000">(</font><font color="#00979c">void</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;
<font color="#00979c">private</font><font color="#434f54">:</font>
 &nbsp;<font color="#00979c">static</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">*</font> <font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">20</font><font color="#000000">]</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;an array of pointers to all active servos</font>
 &nbsp;<font color="#00979c">static</font> <font color="#00979c">int</font> <font color="#000000">servoCount</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the number of active servos</font>
 &nbsp;<font color="#00979c">static</font> <font color="#00979c">int</font> <font color="#000000">currentServoA</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the servo we are currently writing to (timer 1 compare a)</font>
 &nbsp;<font color="#00979c">static</font> <font color="#00979c">int</font> <font color="#000000">currentServoB</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the servo we are currently writing to (timer 1 compare b)</font>
 &nbsp;<font color="#00979c">static</font> <font color="#00979c">bool</font> <font color="#000000">timersInitialized</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;boolean that is true if the hardware timers have been initialized</font>
 &nbsp;<font color="#00979c">static</font> <font color="#00979c">int</font> <font color="#000000">timerResetCount</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;counts the number of time timer 2 has been reset</font>
 &nbsp;<font color="#00979c">int</font> <font color="#000000">pulseWidth</font> <font color="#434f54">=</font> <font color="#000000">1500</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;PWM pulse width, in microseconds(us)</font>
 &nbsp;<font color="#00979c">int</font> <font color="#000000">pin</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the pin the servo is attached to</font>
 &nbsp;<font color="#00979c">static</font> <font color="#00979c">bool</font> <font color="#000000">waiting40Hz</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;initialize the hardware timers 1 and 2 for our use</font>
 &nbsp;<font color="#00979c">void</font> <font color="#000000">initializeTimers</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">cli</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;disable global interrupts</font>

 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;reset a registers to have controll of the timers (analogWrite won&#39;t work anymore on some pins)</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">TCCR2A</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">TCCR1A</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#000000">TCCR1B</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">TCCR1B</font> <font color="#434f54">|=</font> <font color="#000000">(</font><font color="#000000">0</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">CS12</font><font color="#000000">)</font> <font color="#434f54">|</font> <font color="#000000">(</font><font color="#000000">0</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">CS11</font><font color="#000000">)</font> <font color="#434f54">|</font> <font color="#000000">(</font><font color="#000000">1</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">CS10</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;set timer 1 prescaler to 1 (0...65535, 4.096ms)</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">TCCR2B</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">TCCR2B</font> <font color="#434f54">|=</font> <font color="#000000">(</font><font color="#000000">1</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">CS22</font><font color="#000000">)</font> <font color="#434f54">|</font> <font color="#000000">(</font><font color="#000000">1</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">CS21</font><font color="#000000">)</font> &nbsp;<font color="#434f54">|</font> <font color="#000000">(</font><font color="#000000">0</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">CS20</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;set timer 2 to prescaler 256 (0...255, 4.096ms)</font>

 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set timer 2 compare b to 2500 microseconds, for a 400Hz clock.</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;ISR(TIMER2_COMPB_vect) will be called every 2500 microseconds</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;and will reset both timers (1 &amp; 2) to 0</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">OCR2B</font> <font color="#434f54">=</font> <font color="#000000">usToTimer</font><font color="#000000">(</font><font color="#000000">2500</font><font color="#434f54">,</font> <font color="#000000">256</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#000000">TIMSK2</font> <font color="#434f54">|=</font> <font color="#000000">(</font><font color="#000000">1</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">OCIE2B</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;enable timer 2 compare b interrupt</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">TIMSK1</font> <font color="#434f54">|=</font> <font color="#000000">(</font><font color="#000000">1</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">OCIE1B</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;enable timer 1 compare b interrupt</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">TIMSK1</font> <font color="#434f54">|=</font> <font color="#000000">(</font><font color="#000000">1</font> <font color="#434f54">&lt;&lt;</font> <font color="#000000">OCIE1A</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;enable timer 1 compare a interrupt</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#000000">sei</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;enable global interrupts</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;TCNT1</font>
 &nbsp;<font color="#000000">}</font>
<font color="#000000">}</font><font color="#000000">;</font>
<font color="#434f54">&#47;&#47;set some static variables of the Servo class</font>
<b><font color="#d35400">Servo</font></b><font color="#434f54">*</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">20</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">{</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">}</font><font color="#000000">;</font>
<font color="#00979c">bool</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">timersInitialized</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font>
<font color="#00979c">int</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servoCount</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
<font color="#00979c">int</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoA</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
<font color="#00979c">int</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoB</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
<font color="#00979c">int</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">timerResetCount</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
<font color="#00979c">bool</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">waiting40Hz</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font>
<font color="#00979c">bool</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">enabled</font> <font color="#434f54">=</font> <font color="#00979c">true</font><font color="#000000">;</font>

<font color="#434f54">&#47;&#47;this function is called at a 400Hz clock, from timer 1.</font>
<font color="#434f54">&#47;&#47;it first turns on the pin of two servos in parallel</font>
<font color="#434f54">&#47;&#47;and then sets up timer 1 compare a and b to the required</font>
<font color="#434f54">&#47;&#47;pulseWidth of both servos</font>
<font color="#000000">ISR</font><font color="#000000">(</font><font color="#000000">TIMER2_COMPB_vect</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;<font color="#434f54">&#47;&#47;interrupts are disabled by default in an ISR. Here they&#39;re re-enabled</font>
 &nbsp;<font color="#434f54">&#47;&#47;because this ISR is very long and isn&#39;t as important as the interrupt</font>
 &nbsp;<font color="#434f54">&#47;&#47;that handles receiver data (receiverPulse), which is very quick to execute.</font>
 &nbsp;<font color="#434f54">&#47;&#47;this may crash a program when done carelessly, but in this case it works and</font>
 &nbsp;<font color="#434f54">&#47;&#47;the error of the receiver data went from +-100 us to only about +-8 us.</font>
 &nbsp;<font color="#d35400">interrupts</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;reset both timers to 0</font>
 &nbsp;<font color="#000000">TCNT1</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">TCNT2</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;add 1 to the timer reset count (since it has just reset)</font>
 &nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">timerResetCount</font><font color="#434f54">++</font><font color="#000000">;</font>

 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">waiting40Hz</font> <font color="#434f54">==</font> <font color="#00979c">true</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set timer 1 compare a and b to -1 microseconds, to disable them</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">OCR1A</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">OCR1B</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;make sure that 20ms have ellapsed since the first servo write (max 50Hz)</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if not, return and don&#39;t write to any servos.</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">timerResetCount</font> <font color="#434f54">&lt;=</font> <font color="#000000">20000</font> <font color="#434f54">&#47;</font> <font color="#000000">2500</font><font color="#000000">)</font> <font color="#5e6d03">return</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;otherwise, reset timerResetCount and currentServoA &amp; B to -2 and -1.</font>
 &nbsp;&nbsp;&nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">timerResetCount</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoA</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">2</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoB</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set the waiting flag to false</font>
 &nbsp;&nbsp;&nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">waiting40Hz</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>

 &nbsp;<font color="#434f54">&#47;&#47;add 2 to curentServoA, to write to the next servo</font>
 &nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoA</font> <font color="#434f54">+=</font> <font color="#000000">2</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;set currentServoB to curentServoA plus 1</font>
 &nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoB</font> <font color="#434f54">=</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoA</font> <font color="#434f54">+</font> <font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;if we have written to all servos...</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoA</font> <font color="#434f54">&gt;=</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servoCount</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set timer 1 compare a and b to -1 microseconds, to disable them</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">OCR1A</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">OCR1B</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">waiting40Hz</font> <font color="#434f54">=</font> <font color="#00979c">true</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>

 &nbsp;<font color="#434f54">&#47;&#47;turn on the pin for the current servo (compare a)</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">enabled</font><font color="#000000">)</font> <font color="#d35400">digitalWrite</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servos</font><font color="#000000">[</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoA</font><font color="#000000">]</font><font color="#434f54">-</font><font color="#434f54">&gt;</font><font color="#000000">pin</font><font color="#434f54">,</font> <font color="#00979c">HIGH</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;set timer 1 comapre a to currentServoA pulseWidth(us) plus the value of timer 1 plus 50, to have a perfect pulse</font>
 &nbsp;<font color="#000000">OCR1A</font> <font color="#434f54">=</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">usToTimer</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servos</font><font color="#000000">[</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoA</font><font color="#000000">]</font><font color="#434f54">-</font><font color="#434f54">&gt;</font><font color="#000000">pulseWidth</font> <font color="#434f54">+</font> <font color="#000000">50</font> <font color="#95a5a6">&#47;*???*&#47;</font><font color="#434f54">,</font> <font color="#000000">1</font><font color="#000000">)</font> <font color="#434f54">+</font> <font color="#000000">TCNT1</font><font color="#000000">;</font>

 &nbsp;<font color="#434f54">&#47;&#47;if we have written to all servos...</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoB</font> <font color="#434f54">&gt;=</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servoCount</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set timer 1 compare b to -1 microseconds, to disable it</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">OCR1B</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">waiting40Hz</font> <font color="#434f54">=</font> <font color="#00979c">true</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;turn on the pin for the current servo (compare b)</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">enabled</font><font color="#000000">)</font> <font color="#d35400">digitalWrite</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servos</font><font color="#000000">[</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoB</font><font color="#000000">]</font><font color="#434f54">-</font><font color="#434f54">&gt;</font><font color="#000000">pin</font><font color="#434f54">,</font> <font color="#00979c">HIGH</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;set timer 1 comapre b to currentServoB pulseWidth(us) plus the value of timer 1 plus 50, to have a perfect pulse</font>
 &nbsp;<font color="#000000">OCR1B</font> <font color="#434f54">=</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">usToTimer</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servos</font><font color="#000000">[</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoB</font><font color="#000000">]</font><font color="#434f54">-</font><font color="#434f54">&gt;</font><font color="#000000">pulseWidth</font> <font color="#434f54">+</font> <font color="#000000">50</font> <font color="#95a5a6">&#47;*???*&#47;</font><font color="#434f54">,</font> <font color="#000000">1</font><font color="#000000">)</font> <font color="#434f54">+</font> <font color="#000000">TCNT1</font><font color="#000000">;</font>
<font color="#000000">}</font>

<font color="#000000">ISR</font><font color="#000000">(</font><font color="#000000">TIMER1_COMPA_vect</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;<font color="#434f54">&#47;&#47;timer 1 compare a has been set to the right pulse width</font>
 &nbsp;<font color="#434f54">&#47;&#47;when the pulse started, so now we need to turn the servo pin low</font>
 &nbsp;<font color="#d35400">digitalWrite</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servos</font><font color="#000000">[</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoA</font><font color="#000000">]</font><font color="#434f54">-</font><font color="#434f54">&gt;</font><font color="#000000">pin</font><font color="#434f54">,</font> <font color="#00979c">LOW</font><font color="#000000">)</font><font color="#000000">;</font>
<font color="#000000">}</font>

<font color="#000000">ISR</font><font color="#000000">(</font><font color="#000000">TIMER1_COMPB_vect</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;<font color="#434f54">&#47;&#47;timer 1 compare b has been set to the right pulse width</font>
 &nbsp;<font color="#434f54">&#47;&#47;when the pulse started, so now we need to turn the servo pin low</font>
 &nbsp;<font color="#d35400">digitalWrite</font><font color="#000000">(</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">servos</font><font color="#000000">[</font><b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">currentServoB</font><font color="#000000">]</font><font color="#434f54">-</font><font color="#434f54">&gt;</font><font color="#000000">pin</font><font color="#434f54">,</font> <font color="#00979c">LOW</font><font color="#000000">)</font><font color="#000000">;</font>
<font color="#000000">}</font>
























<font color="#434f54">&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;</font>
<font color="#434f54">&#47;&#47; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LEG CLASS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;</font>
<font color="#434f54">&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;</font>


<font color="#00979c">const</font> <font color="#00979c">float</font> <font color="#000000">coxaLength</font> <font color="#434f54">=</font> <font color="#000000">32.5</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;mm</font>
<font color="#00979c">const</font> <font color="#00979c">float</font> <font color="#000000">femurLength</font> <font color="#434f54">=</font> <font color="#000000">45</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;mm</font>
<font color="#00979c">const</font> <font color="#00979c">float</font> <font color="#000000">tibiaLength</font> <font color="#434f54">=</font> <font color="#000000">80</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;mm</font>
<font color="#00979c">const</font> <font color="#00979c">float</font> <font color="#000000">bodyOuterRadius</font> <font color="#434f54">=</font> <font color="#000000">50</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;mm - the distance from the center of the robot to a servo pivot</font>
<font color="#00979c">const</font> <font color="#00979c">float</font> <font color="#000000">legZeroDistance</font> <font color="#434f54">=</font> <font color="#000000">135</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;mm - the default distance from the center of the robot to the end of a leg</font>
<font color="#00979c">const</font> <font color="#00979c">float</font> <font color="#000000">pi</font> <font color="#434f54">=</font> <font color="#000000">3.1415926535897932384626433832795</font><font color="#000000">;</font>

<font color="#00979c">float</font> <font color="#000000">motorsEnabled</font> <font color="#434f54">=</font> <font color="#00979c">true</font><font color="#000000">;</font>

<font color="#434f54">&#47;&#47;a small Vector3 class to handle 3D points</font>
<font color="#00979c">class</font> <font color="#000000">Vector3</font> <font color="#000000">{</font>
<font color="#00979c">public</font><font color="#434f54">:</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">x</font><font color="#434f54">,</font> <font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">Vector3</font><font color="#000000">(</font><font color="#00979c">float</font> <font color="#000000">a</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">b</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">c</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">x</font> <font color="#434f54">=</font> <font color="#000000">a</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">y</font> <font color="#434f54">=</font> <font color="#000000">b</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">z</font> <font color="#434f54">=</font> <font color="#000000">c</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
<font color="#000000">}</font><font color="#000000">;</font>

<font color="#00979c">class</font> <font color="#000000">Leg</font> <font color="#000000">{</font>
<font color="#00979c">public</font><font color="#434f54">:</font>
 &nbsp;<font color="#000000">Vector3</font> <font color="#d35400">position</font> <font color="#434f54">=</font> <font color="#000000">Vector3</font><font color="#000000">(</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the position of a leg, relative to &#39;zero&#39;</font>
 &nbsp;<font color="#000000">Vector3</font> <font color="#000000">zero</font> <font color="#434f54">=</font> <font color="#000000">Vector3</font><font color="#000000">(</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the zero position of a leg</font>
 &nbsp;<font color="#000000">Vector3</font> <font color="#000000">def</font> <font color="#434f54">=</font> <font color="#000000">Vector3</font><font color="#000000">(</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the default position of a leg</font>
 &nbsp;<b><font color="#d35400">Servo</font></b> <font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">]</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the three servos of the leg</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">{</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">}</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;servo offsets if needed</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">angle</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the offset angle of the leg from the x axis of the robot</font>
 &nbsp;<font color="#00979c">bool</font> <font color="#000000">onGround</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;true if a leg should be on the ground</font>
 &nbsp;<font color="#00979c">bool</font> <font color="#000000">lifted</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;true if a leg is currently lifted</font>
 &nbsp;
 &nbsp;<font color="#00979c">int</font> <font color="#000000">pins</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">{</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">}</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;servo pins</font>
 &nbsp;<font color="#000000">Leg</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">pin0</font><font color="#434f54">,</font> <font color="#00979c">int</font> <font color="#000000">pin1</font><font color="#434f54">,</font> <font color="#00979c">int</font> <font color="#000000">pin2</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">pins</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">pin0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">pins</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">pin1</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">pins</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">pin2</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;call this funciton from void setup()</font>
 &nbsp;<font color="#000000">init</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the motors are enabled, </font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">motorsEnabled</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;attach the servos to the right pins</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">attach</font><font color="#000000">(</font><font color="#000000">pins</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">attach</font><font color="#000000">(</font><font color="#000000">pins</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">attach</font><font color="#000000">(</font><font color="#000000">pins</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;calculate the zero position of the leg from its angle (needs to be set before init() is called)</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">zero</font> <font color="#434f54">=</font> <font color="#000000">Vector3</font><font color="#000000">(</font><font color="#d35400">cos</font><font color="#000000">(</font><font color="#000000">angle</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">legZeroDistance</font><font color="#434f54">,</font> <font color="#d35400">sin</font><font color="#000000">(</font><font color="#000000">angle</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">legZeroDistance</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;def = Vector3(zero.x, zero.y, zero.z);</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">def</font> <font color="#434f54">=</font> <font color="#000000">Vector3</font><font color="#000000">(</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;a function to set the position of the leg and update it.</font>
 &nbsp;<font color="#434f54">&#47;&#47;you can also do this manually (but don&#39;t forget to call update())</font>
 &nbsp;<font color="#000000">set</font><font color="#000000">(</font><font color="#00979c">float</font> <font color="#000000">x</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">y</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">z</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">=</font> <font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">=</font> <font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#d35400">update</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;a function to constrain an angle () from 0 to 360 degrees</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">constrainAngle</font><font color="#000000">(</font><font color="#00979c">float</font> <font color="#000000">a</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">a</font> <font color="#434f54">=</font> <font color="#d35400">fmod</font><font color="#000000">(</font><font color="#000000">a</font><font color="#434f54">,</font> <font color="#000000">360</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">a</font> <font color="#434f54">&lt;</font> <font color="#000000">0</font><font color="#000000">)</font> <font color="#000000">a</font> <font color="#434f54">+=</font> <font color="#000000">360</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font> <font color="#000000">a</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;updates the angles of the servomotors from the &#39;position&#39; Vector3</font>
 &nbsp;<font color="#d35400">update</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;&#47;&#47;&#47; INVERSE KINNEMATICS &#47;&#47;&#47;&#47;&#47;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">xo</font> <font color="#434f54">=</font> <font color="#d35400">cos</font><font color="#000000">(</font><font color="#000000">angle</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">bodyOuterRadius</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">yo</font> <font color="#434f54">=</font> <font color="#d35400">sin</font><font color="#000000">(</font><font color="#000000">angle</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">bodyOuterRadius</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">x</font> <font color="#434f54">=</font> <font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">+</font> <font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">y</font> <font color="#434f54">=</font> <font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">+</font> <font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">z</font> <font color="#434f54">=</font> <font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">+</font> <font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">d1</font> <font color="#434f54">=</font> <font color="#d35400">sqrt</font><font color="#000000">(</font><font color="#d35400">pow</font><font color="#000000">(</font><font color="#000000">x</font> <font color="#434f54">-</font> <font color="#000000">xo</font><font color="#434f54">,</font> <font color="#000000">2</font><font color="#000000">)</font> <font color="#434f54">+</font> <font color="#d35400">pow</font><font color="#000000">(</font><font color="#000000">y</font> <font color="#434f54">-</font> <font color="#000000">yo</font><font color="#434f54">,</font> <font color="#000000">2</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">t1</font> <font color="#434f54">=</font> <font color="#d35400">atan2</font><font color="#000000">(</font><font color="#000000">y</font> <font color="#434f54">-</font> <font color="#000000">yo</font><font color="#434f54">,</font> <font color="#000000">x</font> <font color="#434f54">-</font> <font color="#000000">xo</font><font color="#000000">)</font> <font color="#434f54">&#47;</font> <font color="#000000">pi</font> <font color="#434f54">*</font> <font color="#000000">180</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">d1</font> <font color="#434f54">-=</font> <font color="#000000">coxaLength</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">d2</font> <font color="#434f54">=</font> <font color="#d35400">sqrt</font><font color="#000000">(</font><font color="#d35400">pow</font><font color="#000000">(</font><font color="#000000">d1</font><font color="#434f54">,</font> <font color="#000000">2</font><font color="#000000">)</font> <font color="#434f54">+</font> <font color="#d35400">pow</font><font color="#000000">(</font><font color="#000000">z</font><font color="#434f54">,</font> <font color="#000000">2</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">t2</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#d35400">atan2</font><font color="#000000">(</font><font color="#000000">z</font><font color="#434f54">,</font> <font color="#000000">d1</font><font color="#000000">)</font> <font color="#434f54">&#47;</font> <font color="#000000">pi</font> <font color="#434f54">*</font> <font color="#000000">180</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">d2</font> <font color="#434f54">&gt;</font> <font color="#000000">femurLength</font> <font color="#434f54">+</font> <font color="#000000">tibiaLength</font> <font color="#434f54">-</font> <font color="#000000">5</font><font color="#000000">)</font> <font color="#000000">d2</font> <font color="#434f54">=</font> <font color="#000000">femurLength</font> <font color="#434f54">+</font> <font color="#000000">tibiaLength</font> <font color="#434f54">-</font> <font color="#000000">5</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">d2</font> <font color="#434f54">+</font> <font color="#000000">femurLength</font> <font color="#434f54">&lt;</font> <font color="#000000">tibiaLength</font> <font color="#434f54">+</font> <font color="#000000">5</font><font color="#000000">)</font> <font color="#000000">d2</font> <font color="#434f54">=</font> <font color="#000000">tibiaLength</font> <font color="#434f54">+</font> <font color="#000000">5</font> <font color="#434f54">-</font> <font color="#000000">femurLength</font><font color="#000000">;</font>


 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">a0</font> <font color="#434f54">=</font> <font color="#000000">t1</font> <font color="#434f54">-</font> <font color="#000000">angle</font> <font color="#434f54">+</font> <font color="#000000">90</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">a1</font> <font color="#434f54">=</font> <font color="#000000">t2</font> <font color="#434f54">+</font> <font color="#000000">getAngleOppositeTo2ndArgument</font><font color="#000000">(</font><font color="#000000">femurLength</font><font color="#434f54">,</font> <font color="#000000">tibiaLength</font><font color="#434f54">,</font> <font color="#000000">d2</font><font color="#000000">)</font> <font color="#434f54">+</font> <font color="#000000">90</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">a2</font> <font color="#434f54">=</font> <font color="#000000">180</font> <font color="#434f54">+</font> <font color="#434f54">-</font><font color="#000000">getAngleOppositeTo2ndArgument</font><font color="#000000">(</font><font color="#000000">femurLength</font><font color="#434f54">,</font> <font color="#000000">d2</font><font color="#434f54">,</font> <font color="#000000">tibiaLength</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the motors are enabled, write to them</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">motorsEnabled</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">write</font><font color="#000000">(</font><font color="#000000">constrainAngle</font><font color="#000000">(</font><font color="#000000">a0</font> <font color="#434f54">+</font> <font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">write</font><font color="#000000">(</font><font color="#000000">constrainAngle</font><font color="#000000">(</font><font color="#000000">a1</font> <font color="#434f54">+</font> <font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#434f54">-</font> <font color="#000000">20</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">write</font><font color="#000000">(</font><font color="#000000">constrainAngle</font><font color="#000000">(</font><font color="#000000">a2</font> <font color="#434f54">+</font> <font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font> <font color="#434f54">+</font> <font color="#000000">20</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">getAngleOppositeTo2ndArgument</font><font color="#000000">(</font><font color="#00979c">float</font> <font color="#000000">a</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">b</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">c</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">num</font> <font color="#434f54">=</font> <font color="#d35400">pow</font><font color="#000000">(</font><font color="#000000">a</font><font color="#434f54">,</font> <font color="#000000">2</font><font color="#000000">)</font> <font color="#434f54">-</font> <font color="#d35400">pow</font><font color="#000000">(</font><font color="#000000">b</font><font color="#434f54">,</font> <font color="#000000">2</font><font color="#000000">)</font> <font color="#434f54">+</font> <font color="#d35400">pow</font><font color="#000000">(</font><font color="#000000">c</font><font color="#434f54">,</font> <font color="#000000">2</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">denum</font> <font color="#434f54">=</font> <font color="#000000">2</font> <font color="#434f54">*</font> <font color="#000000">a</font> <font color="#434f54">*</font> <font color="#000000">c</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font> <font color="#d35400">acos</font><font color="#000000">(</font><font color="#000000">num</font> <font color="#434f54">&#47;</font> <font color="#000000">denum</font><font color="#000000">)</font> <font color="#434f54">&#47;</font> <font color="#000000">pi</font> <font color="#434f54">*</font> <font color="#000000">180</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
<font color="#000000">}</font><font color="#000000">;</font>

<font color="#434f54">&#47;&#47;a function which returns the hypotenuse of a triangle of sides x and y</font>
<font color="#00979c">float</font> <font color="#000000">getHypot</font><font color="#000000">(</font><font color="#00979c">float</font> <font color="#000000">x</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">y</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;<font color="#5e6d03">return</font> <font color="#000000">(</font><font color="#00979c">float</font><font color="#000000">)</font><font color="#d35400">sqrt</font><font color="#000000">(</font><font color="#000000">x</font> <font color="#434f54">*</font> <font color="#000000">x</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">+</font> <font color="#000000">y</font> <font color="#434f54">*</font> <font color="#000000">y</font> <font color="#434f54">*</font> <font color="#000000">1.0</font><font color="#000000">)</font><font color="#000000">;</font>
<font color="#000000">}</font>
<font color="#434f54">&#47;&#47;a function to move a leg using 3 speeds (x speed, y speed and angular speed)</font>
<font color="#434f54">&#47;&#47;returns the new position of the moved leg (using the time elapsed passed as a parameter)</font>
<font color="#00979c">class</font> <font color="#000000">Vector3</font> <font color="#d35400">move</font><font color="#000000">(</font><font color="#00979c">float</font> <font color="#000000">_xSpeed</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">_ySpeed</font><font color="#434f54">,</font> <font color="#00979c">float</font> <font color="#000000">_aSpeed</font><font color="#434f54">,</font> <font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">timeElapsed</font><font color="#434f54">,</font> <font color="#000000">Vector3</font> <font color="#d35400">position</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;<font color="#434f54">&#47;&#47;get the position of the leg</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">x</font> <font color="#434f54">=</font> <font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">y</font> <font color="#434f54">=</font> <font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;techno voodoo (aka trigonometry) to get the angle from the current leg&#39;s</font>
 &nbsp;<font color="#434f54">&#47;&#47;position to the middle of the robot and the distance between them</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">theta</font> <font color="#434f54">=</font> <font color="#d35400">atan2</font><font color="#000000">(</font><font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">x</font><font color="#000000">)</font> <font color="#95a5a6">&#47;*radian -&gt; degrees*&#47;</font> <font color="#434f54">*</font> <font color="#000000">180</font> <font color="#434f54">&#47;</font> <font color="#000000">pi</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#d35400">hypot</font> <font color="#434f54">=</font> <font color="#000000">getHypot</font><font color="#000000">(</font><font color="#000000">x</font><font color="#434f54">,</font> <font color="#000000">y</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;subtract the angular speed to the angle (in degrees)</font>
 &nbsp;<font color="#000000">theta</font> <font color="#434f54">-=</font> <font color="#000000">_aSpeed</font> <font color="#434f54">*</font> <font color="#000000">timeElapsed</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;get back the coordinates using the distance and the calculated angle</font>
 &nbsp;<font color="#000000">x</font> <font color="#434f54">=</font> <font color="#d35400">cos</font><font color="#000000">(</font><font color="#000000">theta</font> <font color="#95a5a6">&#47;*degrees -&gt; radian*&#47;</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#d35400">hypot</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">y</font> <font color="#434f54">=</font> <font color="#d35400">sin</font><font color="#000000">(</font><font color="#000000">theta</font> <font color="#95a5a6">&#47;*degrees -&gt; radian*&#47;</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#d35400">hypot</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;add the x and y speeds from the coordinates</font>
 &nbsp;<font color="#000000">x</font> <font color="#434f54">+=</font> <font color="#000000">_xSpeed</font> <font color="#434f54">*</font> <font color="#000000">timeElapsed</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">y</font> <font color="#434f54">+=</font> <font color="#000000">_ySpeed</font> <font color="#434f54">*</font> <font color="#000000">timeElapsed</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;return the coordinates from the function</font>
 &nbsp;<font color="#5e6d03">return</font> <font color="#000000">Vector3</font><font color="#000000">(</font><font color="#000000">x</font><font color="#434f54">,</font> <font color="#000000">y</font><font color="#434f54">,</font> <font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">)</font><font color="#000000">;</font>
<font color="#000000">}</font>
<font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">currentMicros</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the current microseconds</font>
<font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">previousMicros</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the previous microseconds</font>
<font color="#00979c">volatile</font> <font color="#00979c">int</font> <font color="#000000">currentChannel</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the current channel written to</font>
<font color="#00979c">volatile</font> <font color="#00979c">int</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">20</font><font color="#000000">]</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the channel data</font>

<font color="#434f54">&#47;&#47;an interrupt function called when a RISING pulse is detected from the receiver pin</font>
<font color="#434f54">&#47;&#47;it uses the PPM protocol to work. </font>
<font color="#00979c">void</font> <font color="#000000">receiverPulse</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;<font color="#434f54">&#47;&#47;keep track of the elapsed time</font>
 &nbsp;<font color="#000000">previousMicros</font> <font color="#434f54">=</font> <font color="#000000">currentMicros</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">currentMicros</font> <font color="#434f54">=</font> <font color="#d35400">micros</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;calculate the elapsed time from the last pulse to now</font>
 &nbsp;<font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">difference</font> <font color="#434f54">=</font> <font color="#000000">currentMicros</font> <font color="#434f54">-</font> <font color="#000000">previousMicros</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;if the time elapsed is bigger than 3000, this means that all the channel pulses</font>
 &nbsp;<font color="#434f54">&#47;&#47;have been sent, so currentChannel is reset to -1</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">difference</font> <font color="#434f54">&gt;</font> <font color="#000000">3000</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">currentChannel</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">1</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;otherwise, write the time elapsed in the corresponding index in channelData</font>
 &nbsp;<font color="#5e6d03">else</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">currentChannel</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">difference</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;increment the channel counter</font>
 &nbsp;<font color="#000000">currentChannel</font><font color="#434f54">++</font><font color="#000000">;</font>
<font color="#000000">}</font>

















<font color="#434f54">&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;</font>
<font color="#434f54">&#47;&#47; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MAIN CODE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;</font>
<font color="#434f54">&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;&#47;</font>



<font color="#00979c">struct</font> <font color="#000000">_robot</font><font color="#000000">{</font>
 &nbsp;<font color="#434f54">&#47;&#47;initialize the legs in an array. calls the leg constructor with the pins of the motors. </font>
 &nbsp;<font color="#434f54">&#47;&#47;first is the coxa motor, next is the femur motor and finally the tibia motor</font>
 &nbsp;<font color="#000000">Leg</font> <font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">6</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">Leg</font><font color="#000000">(</font><font color="#000000">4</font><font color="#434f54">,</font> <font color="#000000">3</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#434f54">,</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">Leg</font><font color="#000000">(</font><font color="#000000">7</font><font color="#434f54">,</font> <font color="#000000">6</font><font color="#434f54">,</font> <font color="#000000">5</font><font color="#000000">)</font><font color="#434f54">,</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">Leg</font><font color="#000000">(</font><font color="#000000">A0</font><font color="#434f54">,</font> <font color="#000000">A1</font><font color="#434f54">,</font> <font color="#000000">A2</font><font color="#000000">)</font><font color="#434f54">,</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">Leg</font><font color="#000000">(</font><font color="#000000">A3</font><font color="#434f54">,</font> <font color="#000000">A4</font><font color="#434f54">,</font> <font color="#000000">A5</font><font color="#000000">)</font><font color="#434f54">,</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">Leg</font><font color="#000000">(</font><font color="#000000">13</font><font color="#434f54">,</font> <font color="#000000">12</font><font color="#434f54">,</font> <font color="#000000">11</font><font color="#000000">)</font><font color="#434f54">,</font> <font color="#434f54">&#47;&#47;pins 12 &amp; 11 replace A6 &amp; A7 (cannot be used as output... a bit strange...)</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">Leg</font><font color="#000000">(</font><font color="#000000">10</font><font color="#434f54">,</font> <font color="#000000">9</font><font color="#434f54">,</font> <font color="#000000">8</font><font color="#000000">)</font>
 &nbsp;<font color="#000000">}</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">Vector3</font> <font color="#000000">angles</font> <font color="#434f54">=</font> <font color="#000000">Vector3</font><font color="#000000">(</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">Vector3</font> <font color="#000000">offsets</font> <font color="#434f54">=</font> <font color="#000000">Vector3</font><font color="#000000">(</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">int</font> <font color="#000000">gateState</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the state of the legs in a gate</font>
 &nbsp;<font color="#00979c">int</font> <font color="#000000">gateName</font> <font color="#434f54">=</font> <font color="#000000">3</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the amount of legs lifted at a time (2 or 3)</font>
<font color="#000000">}</font> <font color="#000000">robot</font><font color="#000000">;</font>

<font color="#434f54">&#47;&#47;set up some stuff</font>
<font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">previousTime</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;previous time</font>
<font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">currentTime</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;current time</font>
<font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">l_time</font> <font color="#434f54">=</font> <font color="#000000">1000</font> <font color="#434f54">&#47;</font> <font color="#000000">3</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;the duration (ms) of a step</font>
<font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">i_time</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;initial time of a step</font>
<font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">f_time</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;final time of a step</font>
<font color="#434f54">&#47;&#47;int sleep = 10; &#47;&#47;</font>
<font color="#434f54">&#47;&#47;float zHeight = 60; &#47;&#47;the z height when a leg is on the ground, mm</font>
<font color="#434f54">&#47;&#47;max speed: 0.15 m &#47; s and 0.03  &#47; s</font>


<font color="#00979c">const</font> <font color="#00979c">bool</font> <font color="#000000">a90</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font> <font color="#434f54">&#47;&#47;set true for 90 servo horn placement</font>

<font color="#00979c">void</font> <font color="#5e6d03">setup</font><font color="#000000">(</font><font color="#000000">)</font> <font color="#000000">{</font>
 &nbsp;<font color="#434f54">&#47;&#47; put your setup code here, to run once:</font>
 &nbsp;<font color="#434f54">&#47;&#47;Serial.begin(115200);</font>


 &nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">10</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">5</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">5</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">5</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">5</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">5</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">10</font><font color="#000000">;</font>
 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;set up the receiver stuff...</font>
 &nbsp;<font color="#000000">currentMicros</font> <font color="#434f54">=</font> <font color="#d35400">micros</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">previousMicros</font> <font color="#434f54">=</font> <font color="#000000">currentMicros</font><font color="#000000">;</font>
 &nbsp;<font color="#d35400">pinMode</font><font color="#000000">(</font><font color="#000000">2</font><font color="#434f54">,</font> <font color="#00979c">INPUT</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#d35400">attachInterrupt</font><font color="#000000">(</font><font color="#d35400">digitalPinToInterrupt</font><font color="#000000">(</font><font color="#000000">2</font><font color="#000000">)</font><font color="#434f54">,</font> <font color="#000000">receiverPulse</font><font color="#434f54">,</font> <font color="#00979c">RISING</font><font color="#000000">)</font><font color="#000000">;</font>

 &nbsp;<font color="#434f54">&#47;&#47;for each leg...</font>
 &nbsp;<font color="#00979c">bool</font> <font color="#000000">onGround</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font>
 &nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">l</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">l</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">l</font><font color="#434f54">++</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set its angle from the x axis of the robot</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">angle</font> <font color="#434f54">=</font> <font color="#000000">l</font> <font color="#434f54">*</font> <font color="#000000">60</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;initialize the leg</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">init</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if a90 is false,</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#434f54">!</font><font color="#000000">a90</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set the leg&#39;s onGround flag, alternating</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">onGround</font> <font color="#434f54">=</font> <font color="#000000">onGround</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;move the leg to 0, 0, 10</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">set</font><font color="#000000">(</font><font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">10</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;change the onGround flag</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">onGround</font> <font color="#434f54">=</font> <font color="#434f54">!</font><font color="#000000">onGround</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if a90 is true, set all the motors to the mathematical 90 position</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font><font color="#5e6d03">else</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">write</font><font color="#000000">(</font><font color="#000000">90</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">write</font><font color="#000000">(</font><font color="#000000">90</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#434f54">-</font> <font color="#000000">20</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servos</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">write</font><font color="#000000">(</font><font color="#000000">90</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">l</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">servoOffsets</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font> <font color="#434f54">+</font> <font color="#000000">20</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">delay</font><font color="#000000">(</font><font color="#000000">100</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;
 &nbsp;
 &nbsp;<font color="#000000">currentTime</font> <font color="#434f54">=</font> <font color="#d35400">millis</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">i_time</font> <font color="#434f54">=</font> <font color="#000000">currentTime</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">f_time</font> <font color="#434f54">=</font> <font color="#000000">i_time</font> <font color="#434f54">+</font> <font color="#000000">l_time</font><font color="#000000">;</font>
 &nbsp;<font color="#d35400">delay</font><font color="#000000">(</font><font color="#000000">10</font><font color="#000000">)</font><font color="#000000">;</font>
<font color="#000000">}</font>

<font color="#00979c">void</font> <font color="#5e6d03">loop</font><font color="#000000">(</font><font color="#000000">)</font> <font color="#000000">{</font>
 &nbsp;<font color="#434f54">&#47;&#47; put your main code here, to run repeatedly:</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">a90</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">delay</font><font color="#000000">(</font><font color="#000000">100</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#000000">previousTime</font> <font color="#434f54">=</font> <font color="#000000">currentTime</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">currentTime</font> <font color="#434f54">=</font> <font color="#d35400">millis</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;Serial.println(currentTime - previousTime);</font>

 &nbsp;<font color="#434f54">&#47;&#47;make sure there was no weird spike in the receiver data</font>
 &nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">c</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">c</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">c</font><font color="#434f54">++</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">c</font><font color="#000000">]</font> <font color="#434f54">&gt;</font> <font color="#000000">2100</font> <font color="#434f54">||</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">c</font><font color="#000000">]</font> <font color="#434f54">&lt;</font> <font color="#000000">400</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">c</font> <font color="#434f54">==</font> <font color="#000000">2</font><font color="#000000">)</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">c</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">1000</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">else</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">c</font><font color="#000000">]</font> <font color="#434f54">=</font> <font color="#000000">1500</font><font color="#000000">;</font>

 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;if the 2-position gate swith is in its upper position, enable the tripod gate</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">5</font><font color="#000000">]</font> <font color="#434f54">&lt;</font> <font color="#000000">1500</font><font color="#000000">)</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateName</font> <font color="#434f54">=</font> <font color="#000000">3</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;else, enable the tetrapod gate</font>
 &nbsp;<font color="#5e6d03">else</font> <font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">5</font><font color="#000000">]</font> <font color="#434f54">&gt;</font> <font color="#000000">1500</font><font color="#000000">)</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateName</font> <font color="#434f54">=</font> <font color="#000000">2</font><font color="#000000">;</font>

 &nbsp;<font color="#434f54">&#47;&#47;if the throttle is at the bottom, disable all the servos</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font> <font color="#434f54">&lt;</font> <font color="#000000">1050</font><font color="#000000">)</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">enabled</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;otherwise, enable them</font>
 &nbsp;<font color="#5e6d03">else</font> <b><font color="#d35400">Servo</font></b><font color="#434f54">:</font><font color="#434f54">:</font><font color="#000000">enabled</font> <font color="#434f54">=</font> <font color="#00979c">true</font><font color="#000000">;</font>

 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;limit the x, y &amp; a channel data to a sphere instead of a cube</font>
 &nbsp;<font color="#434f54">&#47;&#47;this means that even if both x and y speeds are at their maximum,</font>
 &nbsp;<font color="#434f54">&#47;&#47;the speed vector is going to be the same length.</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">x</font> <font color="#434f54">=</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font> <font color="#434f54">-</font> <font color="#000000">1500</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">y</font> <font color="#434f54">=</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font> <font color="#434f54">-</font> <font color="#000000">1500</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">a</font> <font color="#434f54">=</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">]</font> <font color="#434f54">-</font> <font color="#000000">1500</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">theta1</font> <font color="#434f54">=</font> <font color="#d35400">atan2</font><font color="#000000">(</font><font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">x</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">hypot1</font> <font color="#434f54">=</font> <font color="#000000">getHypot</font><font color="#000000">(</font><font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">x</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;if(hypot1 &gt; 500) hypot1 = 500;</font>
 &nbsp;<font color="#434f54">&#47;&#47;if(hypot1 &lt;-500) hypot1 =-500;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">theta2</font> <font color="#434f54">=</font> <font color="#d35400">atan2</font><font color="#000000">(</font><font color="#000000">a</font><font color="#434f54">,</font> <font color="#000000">hypot1</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">hypot2</font> <font color="#434f54">=</font> <font color="#000000">getHypot</font><font color="#000000">(</font><font color="#000000">a</font><font color="#434f54">,</font> <font color="#000000">hypot1</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">hypot2</font> <font color="#434f54">&gt;</font> <font color="#000000">500</font><font color="#000000">)</font> <font color="#000000">hypot2</font> <font color="#434f54">=</font> <font color="#000000">500</font><font color="#000000">;</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">hypot2</font> <font color="#434f54">&lt;</font><font color="#434f54">-</font><font color="#000000">500</font><font color="#000000">)</font> <font color="#000000">hypot2</font> <font color="#434f54">=</font><font color="#434f54">-</font><font color="#000000">500</font><font color="#000000">;</font>
 &nbsp;
 &nbsp;<font color="#000000">hypot1</font> <font color="#434f54">=</font> <font color="#d35400">cos</font><font color="#000000">(</font><font color="#000000">theta2</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">hypot2</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">a</font> <font color="#434f54">=</font> <font color="#d35400">sin</font><font color="#000000">(</font><font color="#000000">theta2</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">hypot2</font> <font color="#434f54">+</font> <font color="#000000">1500</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">x</font> <font color="#434f54">=</font> <font color="#d35400">cos</font><font color="#000000">(</font><font color="#000000">theta1</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">hypot1</font> <font color="#434f54">+</font> <font color="#000000">1500</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">y</font> <font color="#434f54">=</font> <font color="#d35400">sin</font><font color="#000000">(</font><font color="#000000">theta1</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">hypot1</font> <font color="#434f54">+</font> <font color="#000000">1500</font><font color="#000000">;</font>

 &nbsp;
 &nbsp;<font color="#95a5a6">&#47;*Serial.print(x);</font>
<font color="#95a5a6"> &nbsp;Serial.print(&#34;, &#34;);</font>
<font color="#95a5a6"> &nbsp;Serial.print(y);</font>
<font color="#95a5a6"> &nbsp;Serial.print(&#34;, &#34;);</font>
<font color="#95a5a6"> &nbsp;Serial.print(a);</font>
<font color="#95a5a6"> &nbsp;Serial.println();*&#47;</font>

 &nbsp;<font color="#434f54">&#47;&#47;float zHeight= map(channelData[2], 1100, 2000, 10, 82.5) * 1.0;</font>
 &nbsp;<font color="#434f54">&#47;&#47;for each leg...</font>
 &nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">i</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">i</font><font color="#434f54">++</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;set the leg&#39;s height</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">theta</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#d35400">hypot</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">xPos</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">offsets</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">yPos</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">offsets</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">zPos</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">offsets</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;get the angle and the distance from the leg to the center of the robot</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">theta</font> <font color="#434f54">=</font> <font color="#d35400">atan2</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">)</font> <font color="#95a5a6">&#47;*radian -&gt; degrees*&#47;</font> <font color="#434f54">*</font> <font color="#000000">180</font> <font color="#434f54">&#47;</font> <font color="#000000">pi</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">hypot</font> <font color="#434f54">=</font> <font color="#000000">getHypot</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;modify the angle</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">theta</font> <font color="#434f54">+=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">angles</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;get back the coordinates from the leg&#39;s zero position</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">xPos</font> <font color="#434f54">+=</font> <font color="#d35400">cos</font><font color="#000000">(</font><font color="#000000">theta</font> <font color="#95a5a6">&#47;*degrees -&gt; radian*&#47;</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#d35400">hypot</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">yPos</font> <font color="#434f54">+=</font> <font color="#d35400">sin</font><font color="#000000">(</font><font color="#000000">theta</font> <font color="#95a5a6">&#47;*degrees -&gt; radian*&#47;</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#d35400">hypot</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;get the angle and the distance from the leg to the center of the robot</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">theta</font> <font color="#434f54">=</font> <font color="#d35400">atan2</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#434f54">,</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">)</font> <font color="#95a5a6">&#47;*radian -&gt; degrees*&#47;</font> <font color="#434f54">*</font> <font color="#000000">180</font> <font color="#434f54">&#47;</font> <font color="#000000">pi</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">hypot</font> <font color="#434f54">=</font> <font color="#000000">getHypot</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#434f54">,</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;modify the angle</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">theta</font> <font color="#434f54">+=</font> <font color="#434f54">-</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">angles</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;get back the coordinates from the leg&#39;s zero position</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">yPos</font> <font color="#434f54">+=</font> <font color="#d35400">cos</font><font color="#000000">(</font><font color="#000000">theta</font> <font color="#95a5a6">&#47;*degrees -&gt; radian*&#47;</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#d35400">hypot</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">zPos</font> <font color="#434f54">+=</font> <font color="#d35400">sin</font><font color="#000000">(</font><font color="#000000">theta</font> <font color="#95a5a6">&#47;*degrees -&gt; radian*&#47;</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#d35400">hypot</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;get the angle and the distance from the leg to the center of the robot</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">theta</font> <font color="#434f54">=</font> <font color="#d35400">atan2</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#434f54">,</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">)</font> <font color="#95a5a6">&#47;*radian -&gt; degrees*&#47;</font> <font color="#434f54">*</font> <font color="#000000">180</font> <font color="#434f54">&#47;</font> <font color="#000000">pi</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#d35400">hypot</font> <font color="#434f54">=</font> <font color="#000000">getHypot</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#434f54">,</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;modify the angle</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">theta</font> <font color="#434f54">+=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">angles</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;get back the coordinates from the leg&#39;s zero position</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">zPos</font> <font color="#434f54">+=</font> <font color="#d35400">cos</font><font color="#000000">(</font><font color="#000000">theta</font> <font color="#95a5a6">&#47;*degrees -&gt; radian*&#47;</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#d35400">hypot</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">xPos</font> <font color="#434f54">+=</font> <font color="#d35400">sin</font><font color="#000000">(</font><font color="#000000">theta</font> <font color="#95a5a6">&#47;*degrees -&gt; radian*&#47;</font> <font color="#434f54">&#47;</font> <font color="#000000">180</font> <font color="#434f54">*</font> <font color="#000000">pi</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#d35400">hypot</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;write the coordinates to the leg&#39;s position</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">=</font> <font color="#000000">xPos</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">=</font> <font color="#000000">yPos</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#000000">zPos</font><font color="#000000">;</font>

 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;update the leg</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">update</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;
 &nbsp;
 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;if the 3-position mode switch is in the middle, enable rotate mode...</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">4</font><font color="#000000">]</font> <font color="#434f54">&gt;</font> <font color="#000000">1500</font> <font color="#434f54">-</font> <font color="#000000">100</font> <font color="#434f54">&amp;&amp;</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">4</font><font color="#000000">]</font> <font color="#434f54">&lt;</font> <font color="#000000">1500</font> <font color="#434f54">+</font> <font color="#000000">100</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;map the channel data to angular positions</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">angles</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">x</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">20.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">20.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">angles</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">20.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">20.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">angles</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">a</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">30.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">30.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">offsets</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#434f54">,</font> <font color="#000000">1100</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#000000">10</font><font color="#434f54">,</font> <font color="#000000">82.5</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;for each leg...</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">i</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">i</font><font color="#434f54">++</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;float zHeight= map(channelData[2], 1100, 2000, 10, 82.5) * 1.0;</font>
 &nbsp;&nbsp;&nbsp;<font color="#95a5a6">&#47;*</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&#47;&#47;for each leg...</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;for(int i = 0; i &lt; 6; i++){</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;set the leg&#39;s height</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float theta;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float hypot;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float xPos = 0;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float yPos = 0;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float zPos = 0;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;get the angle and the distance from the leg to the center of the robot</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta = atan2(robot.legs[i].zero.y, robot.legs[i].zero.x) &#47;*radian -&gt; degrees * 180 &#47; pi;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hypot = getHypot(robot.legs[i].zero.y, robot.legs[i].zero.x);</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;modify the angle</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta += aPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;get back the coordinates from the leg&#39;s zero position</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xPos += cos(theta &#47;*degrees -&gt; radian &#47; 180 * pi) * hypot - robot.legs[i].zero.x;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yPos += sin(theta &#47;*degrees -&gt; radian &#47; 180 * pi) * hypot - robot.legs[i].zero.y;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;get the angle and the distance from the leg to the center of the robot</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta = atan2(robot.legs[i].zero.z, robot.legs[i].zero.y) &#47;*radian -&gt; degrees * 180 &#47; pi;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hypot = getHypot(robot.legs[i].zero.z, robot.legs[i].zero.y);</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;modify the angle</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta += -bPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;get back the coordinates from the leg&#39;s zero position</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yPos += cos(theta &#47;*degrees -&gt; radian &#47; 180 * pi) * hypot - robot.legs[i].zero.y;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zPos += sin(theta &#47;*degrees -&gt; radian &#47; 180 * pi) * hypot - robot.legs[i].zero.z;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;get the angle and the distance from the leg to the center of the robot</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta = atan2(robot.legs[i].zero.x, robot.legs[i].zero.z) &#47;*radian -&gt; degrees * 180 &#47; pi;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hypot = getHypot(robot.legs[i].zero.x, robot.legs[i].zero.z);</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;modify the angle</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta += cPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;get back the coordinates from the leg&#39;s zero position</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zPos += cos(theta &#47;*degrees -&gt; radian &#47; 180 * pi) * hypot - robot.legs[i].zero.z;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xPos += sin(theta &#47;*degrees -&gt; radian &#47; 180 * pi) * hypot - robot.legs[i].zero.x;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;write the coordinates to the leg&#39;s position</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].def.x = xPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].def.y = yPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].def.z = zPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].position.x = robot.legs[i].def.x;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].position.y = robot.legs[i].def.y;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].position.z = robot.legs[i].def.z + zHeight;</font>
<font color="#95a5a6"></font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;update the leg</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].update();</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;}*&#47;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;if the 3-position mode switch is on the bottom, enable translate mode...</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">4</font><font color="#000000">]</font> <font color="#434f54">&gt;</font> <font color="#000000">2000</font> <font color="#434f54">-</font> <font color="#000000">100</font> <font color="#434f54">&amp;&amp;</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">4</font><font color="#000000">]</font> <font color="#434f54">&lt;</font> <font color="#000000">2000</font> <font color="#434f54">+</font> <font color="#000000">100</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;map the channel data to positions</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">offsets</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">x</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">30.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">30.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">offsets</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">30.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">30.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">angles</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">a</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">30.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">30.0</font> <font color="#434f54">*</font> <font color="#000000">1000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">offsets</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#434f54">,</font> <font color="#000000">1100</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#000000">10</font><font color="#434f54">,</font> <font color="#000000">82.5</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;robot.offsets.z = 0;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;for each leg...</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">i</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">i</font><font color="#434f54">++</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#95a5a6">&#47;*&#47;&#47;for each leg...</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;for(int i = 0; i &lt; 6; i++){</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float theta;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float hypot;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float xPos = -_xPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float yPos = -_yPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float zPos = -_zPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;get the angle and the distance from the leg to the center of the robot</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta = atan2(robot.legs[i].zero.y, robot.legs[i].zero.x) &#47;*radian -&gt; degrees * 180 &#47; pi;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hypot = getHypot(robot.legs[i].zero.y, robot.legs[i].zero.x);</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;modify the angle</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theta += aPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;get back the coordinates from the leg&#39;s zero position</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xPos += cos(theta &#47;*degrees -&gt; radian &#47; 180 * pi) * hypot - robot.legs[i].zero.x;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yPos += sin(theta &#47;*degrees -&gt; radian &#47; 180 * pi) * hypot - robot.legs[i].zero.y;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zPos = 0 - robot.legs[i].zero.z;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;write the coordinates to the leg&#39;s position</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].def.x = xPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].def.y = yPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].def.z = zPos;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].position.x = robot.legs[i].def.x;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].position.y = robot.legs[i].def.y;</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].position.z = robot.legs[i].def.z + zHeight;</font>
<font color="#95a5a6"></font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#47;&#47;update the leg</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot.legs[i].update();</font>
<font color="#95a5a6"> &nbsp;&nbsp;&nbsp;}*&#47;</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">return</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>



 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;map the channel data to speeds</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">xSpeed</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">x</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">0.20</font> <font color="#434f54">*</font> <font color="#000000">1000000</font><font color="#434f54">,</font> <font color="#000000">0.20</font> <font color="#434f54">*</font> <font color="#000000">1000000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000000</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">ySpeed</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">y</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">0.20</font> <font color="#434f54">*</font> <font color="#000000">1000000</font><font color="#434f54">,</font> <font color="#000000">0.20</font> <font color="#434f54">*</font> <font color="#000000">1000000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000000</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">aSpeed</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">a</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">0.09</font> <font color="#434f54">*</font> <font color="#000000">1000000</font><font color="#434f54">,</font> <font color="#000000">0.09</font> <font color="#434f54">*</font> <font color="#000000">1000000</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font> <font color="#434f54">&#47;</font> <font color="#000000">1000000</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">offsets</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">2</font><font color="#000000">]</font><font color="#434f54">,</font> <font color="#000000">1100</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#000000">10</font><font color="#434f54">,</font> <font color="#000000">82.5</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">1.0</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;float zHeight= map(channelData[2], 1100, 2000, 10, 82.5) * 1.0;</font>
 &nbsp;
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateName</font> <font color="#434f54">==</font> <font color="#000000">2</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">xSpeed</font> <font color="#434f54">*=</font> <font color="#000000">2.0</font><font color="#434f54">&#47;</font><font color="#000000">3</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">ySpeed</font> <font color="#434f54">*=</font> <font color="#000000">2.0</font><font color="#434f54">&#47;</font><font color="#000000">3</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">aSpeed</font> <font color="#434f54">*=</font> <font color="#000000">2.0</font><font color="#434f54">&#47;</font><font color="#000000">3</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font>

 &nbsp;<font color="#434f54">&#47;&#47;calculate the ideal step duration...</font>
 &nbsp;
 &nbsp;<font color="#434f54">&#47;&#47;get the greatest and lowest values from the channel data</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">_max</font> <font color="#434f54">=</font> <font color="#d35400">max</font><font color="#000000">(</font><font color="#d35400">max</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#434f54">,</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#000000">)</font><font color="#434f54">,</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#00979c">float</font> <font color="#000000">_min</font> <font color="#434f54">=</font> <font color="#d35400">min</font><font color="#000000">(</font><font color="#d35400">min</font><font color="#000000">(</font><font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">0</font><font color="#000000">]</font><font color="#434f54">,</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">1</font><font color="#000000">]</font><font color="#000000">)</font><font color="#434f54">,</font> <font color="#000000">channelData</font><font color="#000000">[</font><font color="#000000">3</font><font color="#000000">]</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;if min is further from the center of the joystick, then set max to min</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#d35400">abs</font><font color="#000000">(</font><font color="#000000">_min</font> <font color="#434f54">-</font> <font color="#000000">1500</font><font color="#000000">)</font> <font color="#434f54">&gt;</font> <font color="#d35400">abs</font><font color="#000000">(</font><font color="#000000">_max</font> <font color="#434f54">-</font> <font color="#000000">1500</font><font color="#000000">)</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">_max</font> <font color="#434f54">=</font> <font color="#000000">_min</font><font color="#000000">;</font>
 &nbsp;<font color="#434f54">&#47;&#47;map the duration of a step(l_time) from 750 to 250, from</font>
 &nbsp;<font color="#434f54">&#47;&#47;the maximum channel data established above</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">_max</font> <font color="#434f54">&lt;=</font> <font color="#000000">1500</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">l_time</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">_max</font><font color="#434f54">,</font> <font color="#000000">1000</font><font color="#434f54">,</font> <font color="#000000">1500</font><font color="#434f54">,</font> <font color="#000000">1000</font> <font color="#434f54">&#47;</font> <font color="#000000">3</font><font color="#434f54">,</font> <font color="#000000">750</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#5e6d03">else</font> <font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">_max</font> <font color="#434f54">&gt;=</font> <font color="#000000">1500</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">l_time</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">_max</font><font color="#434f54">,</font> <font color="#000000">1500</font><font color="#434f54">,</font> <font color="#000000">2000</font><font color="#434f54">,</font> <font color="#000000">750</font><font color="#434f54">,</font> <font color="#000000">1000</font> <font color="#434f54">&#47;</font> <font color="#000000">3</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">f_time</font> <font color="#434f54">=</font> <font color="#000000">i_time</font> <font color="#434f54">+</font> <font color="#000000">l_time</font><font color="#000000">;</font>



 &nbsp;<font color="#434f54">&#47;&#47;if l_time milliseconds have passed</font>
 &nbsp;<font color="#434f54">&#47;&#47;(if the current time is bigger than the final time)</font>
 &nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">currentTime</font> <font color="#434f54">&gt;=</font> <font color="#000000">f_time</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;initial time = current time</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">i_time</font> <font color="#434f54">=</font> <font color="#000000">f_time</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;final time = initial time + duration of a step</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">f_time</font> <font color="#434f54">=</font> <font color="#000000">i_time</font> <font color="#434f54">+</font> <font color="#000000">l_time</font><font color="#000000">;</font>


 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;put each leg on the ground (temporarely)</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">i</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">i</font><font color="#434f54">++</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">onGround</font> <font color="#434f54">=</font> <font color="#00979c">true</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">lifted</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>

 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the tripod gate is selected...</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateName</font> <font color="#434f54">==</font> <font color="#000000">3</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;make sure the gate state is from 0 to 1</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateState</font> <font color="#434f54">&gt;=</font> <font color="#000000">2</font><font color="#000000">)</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateState</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;lift some legs depending on the gate state</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">i</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">+=</font> <font color="#000000">2</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateState</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">onGround</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font><font color="#5e6d03">else</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the tetrapod gate is selected...</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateName</font> <font color="#434f54">==</font> <font color="#000000">2</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;make sure the gate state is from 0 to 2</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateState</font> <font color="#434f54">&gt;=</font> <font color="#000000">3</font><font color="#000000">)</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateState</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;lift some legs depending on the gate state</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">i</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">+=</font> <font color="#000000">3</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateState</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">onGround</font> <font color="#434f54">=</font> <font color="#00979c">false</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;increment the gate state</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateState</font><font color="#434f54">++</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;&#47;&#47;lift some legs and lower others</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;for(int i = 0; i &lt; 6; i++){</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; &nbsp;legs[i].onGround = !legs[i].onGround;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; &nbsp;legs[i].lifted = false;</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;}</font>
 &nbsp;<font color="#000000">}</font>
 &nbsp;<font color="#434f54">&#47;&#47;for each leg...</font>
 &nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">int</font> <font color="#000000">i</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">i</font> <font color="#434f54">&lt;</font> <font color="#000000">6</font><font color="#000000">;</font> <font color="#000000">i</font><font color="#434f54">++</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">fraction</font> <font color="#434f54">=</font> <font color="#000000">1.0</font><font color="#434f54">&#47;</font><font color="#000000">10.0</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#95a5a6">&#47;*robot.offsets.z + *&#47;</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the leg is lifted,</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">onGround</font> <font color="#434f54">==</font> <font color="#00979c">false</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the remaining time for the step is smaller than 1&#47;5 of the step</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;(if we&#39;re on the last 1&#47;5 of the step) and if the leg is lifted</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if(f_time - currentTime &lt; l_time * fraction &amp;&amp; legs[i].lifted == true){</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; &nbsp;&#47;&#47;lower the leg from zHeight * (4&#47;5) to zHeight</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47; &nbsp;legs[i].position.z = map(f_time - currentTime, l_time * fraction, 0, zHeight * (1.0 - fraction * 2), zHeight);</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;}else{ &#47;&#47;if we&#39;re on the first 4&#47;5 of the step,</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;then move the leg towards the ideal position...</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;get the leg&#39;s position</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">pos_x</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">pos_y</font> <font color="#434f54">=</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;f_pos is the final position a lifted leg needs to get to</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;(or half the total travel of the leg)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">f_pos_x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">f_pos_y</font><font color="#000000">;</font>
 &nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;create a Vector3 holding the leg&#39;s default position</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;(the position where the leg can easily move in every direction)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">Vector3</font> <font color="#000000">newPosition</font> <font color="#434f54">=</font> <font color="#000000">Vector3</font><font color="#000000">(</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#434f54">,</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#434f54">,</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;find the ideal position for the leg if the speeds would not change</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;(&#39;currentTime - previousTime&#39; ms increments of time)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">for</font><font color="#000000">(</font><font color="#00979c">unsigned</font> <font color="#00979c">long</font> <font color="#000000">ms</font> <font color="#434f54">=</font> <font color="#000000">0</font><font color="#000000">;</font> <font color="#000000">ms</font> <font color="#434f54">&lt;</font> <font color="#000000">l_time</font> <font color="#434f54">&#47;</font> <font color="#000000">2</font> <font color="#434f54">*</font> <font color="#000000">(</font><font color="#000000">1</font> <font color="#434f54">+</font> <font color="#000000">fraction</font> <font color="#434f54">*</font> <font color="#000000">1.0</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">(</font><font color="#000000">6</font> <font color="#434f54">&#47;</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">gateName</font> <font color="#434f54">-</font> <font color="#000000">1</font><font color="#000000">)</font><font color="#000000">;</font> <font color="#000000">ms</font> <font color="#434f54">+=</font> <font color="#000000">50</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">newPosition</font> <font color="#434f54">=</font> <font color="#d35400">move</font><font color="#000000">(</font><font color="#000000">xSpeed</font><font color="#434f54">,</font> <font color="#000000">ySpeed</font><font color="#434f54">,</font> <font color="#000000">aSpeed</font><font color="#434f54">,</font> <font color="#000000">50</font><font color="#434f54">,</font> <font color="#000000">newPosition</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">f_pos_x</font> <font color="#434f54">=</font> <font color="#000000">newPosition</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">f_pos_y</font> <font color="#434f54">=</font> <font color="#000000">newPosition</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the leg travells more than x mm and if we&#39;re at the beginning of the step,</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">getHypot</font><font color="#000000">(</font><font color="#000000">f_pos_x</font> <font color="#434f54">-</font> <font color="#000000">pos_x</font><font color="#434f54">,</font> <font color="#000000">f_pos_y</font> <font color="#434f54">-</font> <font color="#000000">pos_y</font><font color="#000000">)</font> <font color="#434f54">&gt;</font> <font color="#000000">10</font> <font color="#434f54">&amp;&amp;</font> <font color="#000000">currentTime</font> <font color="#434f54">-</font> <font color="#000000">i_time</font> <font color="#434f54">&lt;</font> <font color="#000000">l_time</font> <font color="#434f54">*</font> <font color="#000000">2.0</font> <font color="#434f54">&#47;</font> <font color="#000000">3</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;then lift the leg</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">lifted</font> <font color="#434f54">=</font> <font color="#00979c">true</font><font color="#000000">;</font>
 &nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the leg is lifted and if we&#39;re on the first 4&#47;5 of the step, then move the leg...</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">lifted</font> <font color="#434f54">==</font> <font color="#00979c">true</font> <font color="#434f54">&amp;&amp;</font> <font color="#000000">f_time</font> <font color="#434f54">-</font> <font color="#000000">currentTime</font> <font color="#434f54">&gt;</font> <font color="#000000">l_time</font> <font color="#434f54">*</font> <font color="#000000">fraction</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;l_speed is the speed a lifted leg needs to travel to get to f_pos in time</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;leg speed = (distance remaining) &#47; (time remaining * (4&#47;5))</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">l_speed_x</font> <font color="#434f54">=</font> <font color="#000000">(</font><font color="#000000">f_pos_x</font> <font color="#434f54">-</font> <font color="#000000">pos_x</font><font color="#000000">)</font> <font color="#434f54">&#47;</font> <font color="#000000">(</font><font color="#000000">(</font><font color="#000000">f_time</font> <font color="#434f54">-</font> <font color="#000000">currentTime</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">(</font><font color="#000000">1.0</font> <font color="#434f54">-</font> <font color="#000000">fraction</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">l_speed_y</font> <font color="#434f54">=</font> <font color="#000000">(</font><font color="#000000">f_pos_y</font> <font color="#434f54">-</font> <font color="#000000">pos_y</font><font color="#000000">)</font> <font color="#434f54">&#47;</font> <font color="#000000">(</font><font color="#000000">(</font><font color="#000000">f_time</font> <font color="#434f54">-</font> <font color="#000000">currentTime</font><font color="#000000">)</font> <font color="#434f54">*</font> <font color="#000000">(</font><font color="#000000">1.0</font> <font color="#434f54">-</font> <font color="#000000">fraction</font><font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;limit the speed of a leg in x and y to 50 cm &#47; s</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#00979c">float</font> <font color="#000000">max_speed</font> <font color="#434f54">=</font> <font color="#000000">0.50</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">l_speed_x</font> <font color="#434f54">&gt;</font> <font color="#000000">max_speed</font><font color="#000000">)</font> <font color="#000000">l_speed_x</font> <font color="#434f54">=</font> <font color="#000000">max_speed</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">l_speed_y</font> <font color="#434f54">&gt;</font> <font color="#000000">max_speed</font><font color="#000000">)</font> <font color="#000000">l_speed_y</font> <font color="#434f54">=</font> <font color="#000000">max_speed</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">l_speed_x</font> <font color="#434f54">&lt;</font> <font color="#434f54">-</font><font color="#000000">max_speed</font><font color="#000000">)</font> <font color="#000000">l_speed_x</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">max_speed</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">l_speed_y</font> <font color="#434f54">&lt;</font> <font color="#434f54">-</font><font color="#000000">max_speed</font><font color="#000000">)</font> <font color="#000000">l_speed_y</font> <font color="#434f54">=</font> <font color="#434f54">-</font><font color="#000000">max_speed</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;then move it towards f_pos with a speed of l_speed</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">+=</font> <font color="#000000">l_speed_x</font> <font color="#434f54">*</font> <font color="#000000">(</font><font color="#000000">currentTime</font> <font color="#434f54">-</font> <font color="#000000">previousTime</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">+=</font> <font color="#000000">l_speed_y</font> <font color="#434f54">*</font> <font color="#000000">(</font><font color="#000000">currentTime</font> <font color="#434f54">-</font> <font color="#000000">previousTime</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the leg is lifted, then modify its height</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">lifted</font> <font color="#434f54">==</font> <font color="#00979c">true</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if we&#39;re on the first half of the step,</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">currentTime</font> <font color="#434f54">-</font> <font color="#000000">i_time</font> <font color="#434f54">&lt;</font> <font color="#000000">l_time</font> <font color="#434f54">&#47;</font> <font color="#000000">2</font><font color="#000000">)</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;raise the leg from zHeight to 0 mm</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">currentTime</font> <font color="#434f54">-</font> <font color="#000000">i_time</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">l_time</font> <font color="#434f54">&#47;</font> <font color="#000000">2</font><font color="#434f54">,</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#95a5a6">&#47;*+ robot.offsets.z*&#47;</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;else if we&#39;re on the second half of the step,</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#5e6d03">else</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;lower the leg from 0 to zHeight * (4&#47;5) mm</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#d35400">map</font><font color="#000000">(</font><font color="#000000">currentTime</font> <font color="#434f54">-</font> <font color="#000000">i_time</font><font color="#434f54">,</font> <font color="#000000">l_time</font> <font color="#434f54">&#47;</font> <font color="#000000">2</font><font color="#434f54">,</font> <font color="#000000">l_time</font><font color="#434f54">,</font> <font color="#000000">0</font><font color="#434f54">,</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">def</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#95a5a6">&#47;*+ robot.offsets.z*&#47;</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;if the leg is on the ground or if we&#39;re on the last 1&#47;5 of the step,</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;then move it reverse the direction of the speed</font>
 &nbsp;&nbsp;&nbsp;<font color="#5e6d03">if</font><font color="#000000">(</font><font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">onGround</font> <font color="#434f54">==</font> <font color="#00979c">true</font> <font color="#434f54">||</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">lifted</font> <font color="#434f54">==</font> <font color="#00979c">false</font> <font color="#434f54">||</font> <font color="#000000">f_time</font> <font color="#434f54">-</font> <font color="#000000">currentTime</font> <font color="#434f54">&lt;</font> <font color="#000000">l_time</font> <font color="#434f54">*</font> <font color="#000000">fraction</font><font color="#000000">)</font><font color="#000000">{</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;legs[i].lifted = false;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;legs[i].position.z = zHeight;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">Vector3</font> <font color="#000000">newPosition</font> <font color="#434f54">=</font> <font color="#d35400">move</font><font color="#000000">(</font><font color="#434f54">-</font><font color="#000000">xSpeed</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">ySpeed</font><font color="#434f54">,</font> <font color="#434f54">-</font><font color="#000000">aSpeed</font><font color="#434f54">,</font> <font color="#000000">currentTime</font> <font color="#434f54">-</font> <font color="#000000">previousTime</font><font color="#434f54">,</font> <font color="#000000">Vector3</font><font color="#000000">(</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#434f54">,</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#434f54">,</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">+</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">)</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;update the position of the leg</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">=</font> <font color="#000000">newPosition</font><font color="#434f54">.</font><font color="#000000">x</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">x</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">=</font> <font color="#000000">newPosition</font><font color="#434f54">.</font><font color="#000000">y</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">y</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">position</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">=</font> <font color="#000000">newPosition</font><font color="#434f54">.</font><font color="#000000">z</font> <font color="#434f54">-</font> <font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#000000">zero</font><font color="#434f54">.</font><font color="#000000">z</font><font color="#000000">;</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">}</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;Serial.print(legs[0].position.x);</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;Serial.print(&#34;, &#34;);</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;Serial.print(legs[0].position.y);</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;Serial.print(&#34;, &#34;);</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;Serial.print(legs[0].position.z);</font>
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;Serial.println();</font>
 &nbsp;&nbsp;&nbsp;
 &nbsp;&nbsp;&nbsp;<font color="#434f54">&#47;&#47;update the leg</font>
 &nbsp;&nbsp;&nbsp;<font color="#000000">robot</font><font color="#434f54">.</font><font color="#000000">legs</font><font color="#000000">[</font><font color="#000000">i</font><font color="#000000">]</font><font color="#434f54">.</font><font color="#d35400">update</font><font color="#000000">(</font><font color="#000000">)</font><font color="#000000">;</font>
 &nbsp;<font color="#000000">}</font> <font color="#434f54">&#47;&#47;next leg</font>

 &nbsp;<font color="#434f54">&#47;&#47;wait a bit to slow down the update frequency</font>
 &nbsp;<font color="#434f54">&#47;&#47;(actually... no. the update frequency is too slow)</font>
 &nbsp;<font color="#434f54">&#47;&#47;delay(sleep);</font>
<font color="#000000">}</font>


</pre>